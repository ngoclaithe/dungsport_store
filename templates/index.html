<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dung Sport - Cửa hàng thể thao chính hãng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toast_style.css') }}">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="DungSport Logo">
                </div>
                <div class="search-bar">
                    <input type="text" placeholder="Tìm sản phẩm...">
                    <button type="submit"><i class="fas fa-search"></i></button>
                </div>
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="user-actions">
                    <div class="action-item contact-btn">
                        <i class="fas fa-headset"></i>
                        <span>Tư vấn mua hàng 0823885888</span>
                    </div>
                    <div class="action-item">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div class="action-item">
                        <i class="fas fa-heart"></i>
                        <span class="badge">0</span>
                    </div>
                    <div class="action-item">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="action-item">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="badge">0</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav class="navigation" id="mainNav">
        <div class="container">
            <ul class="nav-menu">
                <li class="nav-item">
                    Danh mục sản phẩm 
                    <i class="fas fa-chevron-down expand-icon"></i>
                </li>
                <li class="nav-item">Sale off Bóng rổ</li>
                <li class="nav-item">Sale off Pickleball</li>
            </ul>
        </div>
    </nav>
        
    <!-- Hero Banner Section -->
    <section class="hero-banner">
        <div class="hero-banner-slider">
            <img id="slider" class="banner-image" src="{{ url_for('static', filename='images/slider_1.png') }}" alt="Banner">
        </div>
    </section>

    <!-- Product Grid Section -->
    <section class="product-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Sản phẩm nổi bật</h2>
                <a href="#" class="view-all">Xem tất cả <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="product-grid"></div>
        </div>
    </section>
    
    <!-- Benefits Section -->
    <section class="benefits-section">
        <div class="container">
            <div class="benefits-grid">
                <!-- Ô 1 -->
                <div class="benefit-card">
                    <i class="fas fa-shipping-fast"></i>
                    <div class="benefit-text">
                        <h4>Vận chuyển siêu tốc</h4>
                        <p>Nhận hàng toàn quốc</p>
                    </div>
                </div>
                <!-- Ô 2 -->
                <div class="benefit-card">
                    <i class="fas fa-shield-alt"></i>
                    <div class="benefit-text">
                        <h4>Cam kết chính hãng</h4>
                        <p>Sản phẩm chuẩn, đổi trả dễ</p>
                    </div>
                </div>
                <!-- Ô 3 -->
                <div class="benefit-card">
                    <i class="fas fa-credit-card"></i>
                    <div class="benefit-text">
                        <h4>Thanh toán thuận tiện</h4>
                        <p>Nhiều phương thức linh hoạt</p>
                    </div>
                </div>
                <!-- Ô 4 -->
                <div class="benefit-card">
                    <i class="fas fa-undo-alt"></i>
                    <div class="benefit-text">
                        <h4>100% Hoàn tiền</h4>
                        <p>Nếu sai sản phẩm yêu cầu</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- New Arrival Section -->
    <section class="new-arrival-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Sản phẩm mới về</h2>
                <a href="#" class="view-all">Xem tất cả <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="new-arrival-grid"></div>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Danh mục sản phẩm</h2>
                <a href="#" class="view-all">Xem tất cả <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="categories-grid"></div>
        </div>
    </section>

    <!-- Featured Products Section -->
    <section class="featured-section product-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Đồ thể thao giảm giá</h2>
                <a href="#" class="view-all">Xem tất cả <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="product-grid"></div>
        </div>
    </section>

    <!-- Brand Logo Grid Section -->
    <section class="brand-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Thương hiệu nổi bật</h2>
            </div>
            <div class="brand-grid">
                <div class="brand-card">
                    <img class="brand-image" src="/api/placeholder/150/60" alt="Brand 1">
                </div>
                <div class="brand-card">
                    <img class="brand-image" src="/api/placeholder/150/60" alt="Brand 2">
                </div>
                <div class="brand-card">
                    <img class="brand-image" src="/api/placeholder/150/60" alt="Brand 3">
                </div>
                <div class="brand-card">
                    <img class="brand-image" src="/api/placeholder/150/60" alt="Brand 4">
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Khách hàng nói gì về chúng tôi</h2>
            </div>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-header">
                        <div class="testimonial-avatar">
                            <img src="{{ url_for('static', filename='images/customer1.png') }}" alt="Khách hàng 1">
                        </div>
                        <div class="testimonial-info">
                            <h4>Nguyễn Văn A</h4>
                            <div class="rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-content">
                        Tôi rất hài lòng với chất lượng sản phẩm và dịch vụ tại Dung Sport. Đặc biệt là giày bóng đá Nike mua gần đây rất tốt và chính hãng. Nhân viên tư vấn nhiệt tình. Sẽ ủng hộ shop lâu dài!
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-header">
                        <div class="testimonial-avatar">
                            <img src="{{ url_for('static', filename='images/customer1.png') }}" alt="Khách hàng 2">
                        </div>
                        <div class="testimonial-info">
                            <h4>Trần Thị B</h4>
                            <div class="rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-content">
                        Giao hàng nhanh, đóng gói cẩn thận. Balo thể thao mình mua chất lượng tuyệt vời. Rất đáng đồng tiền bát gạo. Sẽ tiếp tục ủng hộ shop!
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-header">
                        <div class="testimonial-avatar">
                            <img src="{{ url_for('static', filename='images/customer1.png') }}" alt="Khách hàng 3">
                        </div>
                        <div class="testimonial-info">
                            <h4>Lê Văn C</h4>
                            <div class="rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-content">
                        Đồ thể thao ở Dung Sport rất đa dạng, giá cả hợp lý và quan trọng là hàng chính hãng 100%. Mình đã mua ở đây nhiều lần và chưa bao giờ thất vọng. Nhân viên tư vấn rất chuyên nghiệp!
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter-section">
        <div class="container">
            <h2>Đăng ký nhận thông tin</h2>
            <p>Nhận thông tin về sản phẩm mới, khuyến mãi đặc biệt và các sự kiện từ Dung Sport</p>
            <form class="newsletter-form">
                <input type="email" placeholder="Nhập email của bạn...">
                <button type="submit">Đăng ký</button>
            </form>
        </div>
    </section>

    <!-- Footer Contact Section -->
    <section class="footer-contact">
        <div class="contact-item zalo-contact">
            <i class="fas fa-comment"></i>
            <span>0823885888</span>
        </div>
        <div class="contact-item phone-contact">
            <i class="fas fa-phone"></i>
            <span>0823885888</span>
        </div>
        <div class="contact-item messenger-contact">
            <i class="fab fa-facebook-messenger"></i>
        </div>
        <div class="messenger-popup">
            <div>Liên hệ ngay !</div>
        </div>
    </section>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Footer Section -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Về Dung Sport</h3>
                    <ul>
                        <li><a href="#">Giới thiệu</a></li>
                        <li><a href="#">Tin tức</a></li>
                        <li><a href="#">Tuyển dụng</a></li>
                        <li><a href="#">Liên hệ</a></li>
                        <li><a href="#">Hệ thống cửa hàng</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Hỗ trợ khách hàng</h3>
                    <ul>
                        <li><a href="#">Hướng dẫn mua hàng</a></li>
                        <li><a href="#">Chính sách đổi trả</a></li>
                        <li><a href="#">Chính sách bảo hành</a></li>
                        <li><a href="#">Phương thức thanh toán</a></li>
                        <li><a href="#">Vận chuyển & giao nhận</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Danh mục sản phẩm</h3>
                    <ul>
                        <li><a href="#">Đồ bóng đá</a></li>
                        <li><a href="#">Đồ bóng chuyền</a></li>
                        <li><a href="#">Đồ bi-a</a></li>
                        <li><a href="#">Pickleball</a></li>
                        <li><a href="#">Phụ kiện thể thao</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Liên hệ với chúng tôi</h3>
                    <div class="footer-contact-info">
                        <div>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>123 Đường ABC, Quận XYZ, TP. Hồ Chí Minh</span>
                        </div>
                        <div>
                            <i class="fas fa-phone-alt"></i>
                            <span>0823885888</span>
                        </div>
                        <div>
                            <i class="fas fa-envelope"></i>
                            <span>info@dungsport.vn</span>
                        </div>
                    </div>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Dung Sport. Tất cả các quyền được bảo lưu.</p>
                <div class="payment-methods-horizontal">
                    <img src="{{ url_for('static', filename='images/visa.jpg') }}" alt="Visa">
                    <img src="{{ url_for('static', filename='images/mastercard.png') }}" alt="MasterCard">
                    <img src="{{ url_for('static', filename='images/momo.png') }}" alt="Momo">
                    <img src="{{ url_for('static', filename='images/zalo.png') }}" alt="ZaloPay">
                </div>
            </div> 
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Slider Image Change
        const images = [
            "{{ url_for('static', filename='images/slider_1.png') }}",
            "{{ url_for('static', filename='images/slider_2.png') }}",
            "{{ url_for('static', filename='images/slider_3.png') }}"
        ];
        let current = 0;
        setInterval(() => {
            current = (current + 1) % images.length;
            const slider = document.getElementById('slider');
            slider.style.opacity = '0';
            setTimeout(() => {
                slider.src = images[current];
                slider.style.opacity = '1';
            }, 500);
        }, 5000);
        
        document.addEventListener("DOMContentLoaded", function(){
            const brandCards = document.querySelectorAll('.brand-card');
            const brands = [
                "{{ url_for('static', filename='images/logo1.png') }}",
                "{{ url_for('static', filename='images/logo2.png') }}",
                "{{ url_for('static', filename='images/logo3.png') }}",
                "{{ url_for('static', filename='images/logo4.jpg') }}",
                "{{ url_for('static', filename='images/logo5.png') }}",
                "{{ url_for('static', filename='images/logo6.png') }}",
                "{{ url_for('static', filename='images/logo7.png') }}",
                "{{ url_for('static', filename='images/logo8.png') }}"
            ];
            let current = 0;
            const totalCards = brandCards.length;
            function updateBrands() {
                brandCards.forEach((card, index) => {
                    const img = card.querySelector('.brand-image');
                    img.src = brands[(current + index) % brands.length];
                });
            }
            updateBrands();
            setInterval(() => {
                current = (current + totalCards) % brands.length;
                updateBrands();
            }, 3000);
        });

        function showToast(message, isError = false) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = isError ? 'toast error' : 'toast';
            const icon = isError ? '<i class="fas fa-exclamation-circle"></i>' : '<i class="fas fa-check-circle"></i>';
            toast.innerHTML = `${icon} ${message}`;
            toastContainer.appendChild(toast);
            toast.offsetHeight;
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        async function fetchFeaturedProducts() {
            try {
                const response = await fetch('/api/featured_products');
                const products = await response.json();
                const productGrid = document.querySelector('.product-section .product-grid');
                productGrid.innerHTML = ''; 

                products.forEach(product => {
                    const productCard = `
                        <div class="product-card" onclick="window.location.href='/detail-product/${product.id}'">
                            <div class="product-badge">${product.badge}</div>
                            <div class="product-image-container">
                                <img class="product-image" src="${product.image}" alt="${product.name}">
                            </div>
                            <div class="product-details">
                                <h3 class="product-name">${product.name}</h3>
                                <div class="product-price">
                                    <span class="current-price">${product.currentPrice}</span>
                                    <span class="original-price">${product.originalPrice}</span>
                                    <span class="discount-percentage">${product.discount}</span>
                                </div>
                                <button class="add-to-favorite" data-product-id="${product.id}" data-product-name="${product.name}" onclick="event.stopPropagation();">
                                    <i class="fas fa-heart"></i> Thêm vào yêu thích
                                </button>
                            </div>
                        </div>
                    `;
                    productGrid.innerHTML += productCard;
                });
            } catch (error) {
                console.error('Error fetching featured products:', error);
            }
        }
    
        async function fetchNewArrival() {
            try {
                const response = await fetch('/api/new_arrival');
                const products = await response.json(); 
                const productGrid = document.querySelector('.new-arrival-section .new-arrival-grid'); 
                productGrid.innerHTML = ''; 

                products.forEach(product => {
                    const productCard = `
                        <div class="product-card" onclick="window.location.href='/detail-product/${product.id}'">
                            <div class="product-image-container">
                                <img class="product-image" src="${product.image_url}" alt="${product.product_name}">
                            </div>
                            <div class="product-details">
                                <h3 class="product-name">${product.product_name}</h3>
                                <div class="product-price">
                                    <span class="current-price">${product.price}₫</span>
                                </div>
                                <button class="add-to-favorite" data-product-id="${product.id}" data-product-name="${product.product_name}" onclick="event.stopPropagation();">
                                    <i class="fas fa-heart"></i> Thêm vào yêu thích
                                </button>
                            </div>
                        </div>
                    `;
                    productGrid.innerHTML += productCard; 
                });
            } catch (error) {
                console.error('Error fetching new arrival products:', error);
            }
        }

        async function fetchProductsOnSale() {
            try {
                const response = await fetch('/api/product_on_sale_best');
                const products = await response.json();
                const productGrid = document.querySelector('.featured-section .product-grid');
                productGrid.innerHTML = ''; 
        
                products.forEach(product => {
                    const computedOriginalPrice = product.discount > 0 
                        ? product.price / (1 - product.discount / 100)
                        : product.price;
                    const originalPrice = Math.round(computedOriginalPrice / 1000) * 1000;
                    
                    const productCard = `
                        <div class="product-card" onclick="window.location.href='/detail-product/${product.id}'">
                            <div class="product-image-container">
                                <img class="product-image" src="${product.image_url}" alt="${product.product_name}">
                            </div>
                            <div class="product-details">
                                <h3 class="product-name">${product.product_name}</h3>
                                <div class="product-price">
                                    <span class="current-price">${product.price}</span>
                                    <span class="original-price">${originalPrice}</span>
                                    <span class="discount-percentage">${product.discount}%</span>
                                </div>
                                <button class="add-to-favorite" data-product-id="${product.id}" data-product-name="${product.product_name}" onclick="event.stopPropagation();">
                                    <i class="fas fa-heart"></i> Thêm vào yêu thích
                                </button>
                            </div>
                        </div>
                    `;
                    productGrid.innerHTML += productCard;
                });
            } catch (error) {
                console.error('Error fetching products on sale:', error);
            }
        }
        
        function attachFavoriteButtonEvents() {
            const favoriteButtons = document.querySelectorAll('.add-to-favorite');
        
            favoriteButtons.forEach(button => {
                button.addEventListener('click', function () {
                    console.log("Vừa bấm thêm yêu thích");
                    const productId = this.getAttribute('data-product-id');
                    const productName = this.getAttribute('data-product-name') || 'Sản phẩm';
                    addToFavorites(productId, productName);
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', function () {
            Promise.all([
                fetchProductCatalog(),
                fetchProductsOnSale(),
                fetchNewArrival(),
                fetchFeaturedProducts()
            ]).then(() => {
                attachFavoriteButtonEvents(); 
            }).catch(error => {
                console.error("Lỗi khi tải dữ liệu:", error);
            });
        
            updateFavoriteCount();
        });
        
        function addToFavorites(productId, productName) {
            let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            if (!favorites.includes(productId)) {
                favorites.push(productId); 
                localStorage.setItem('favorites', JSON.stringify(favorites)); 
                showToast(`${productName} đã được thêm vào yêu thích!`);
                updateFavoriteCount(); 
            } else {
                showToast(`${productName} đã có trong danh sách yêu thích!`, true);
            }
        }
        
        function updateFavoriteCount() {
            const favoriteCount = document.querySelector('.fa-heart + .badge');
            if (favoriteCount) {
                const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                favoriteCount.textContent = favorites.length; 
            }
        }

        async function fetchProductCatalog() {
            try {
                const response = await fetch('/api/product_catalog');
                const categories = await response.json();
                const categoriesGrid = document.querySelector('.categories-section .categories-grid');
                categoriesGrid.innerHTML = ''; 
        
                categories.forEach(category => {
                    const imageUrl = category.image || '/api/placeholder/400/300'; 
                    const categoryCard = `
                        <div class="category-card">
                            <img src="${imageUrl}" alt="${category.name}">
                            <div class="category-overlay">
                                <h3 class="category-name">${category.name}</h3>
                                <div class="category-count">${category.count} sản phẩm</div>
                            </div>
                        </div>
                    `;
                    categoriesGrid.innerHTML += categoryCard;
                });
            } catch (error) {
                console.error('Error fetching product catalog:', error);
            }
        }
    </script>
    <script src="{{ url_for('static', filename='js/header.js') }}"></script>
</body>
</html>
